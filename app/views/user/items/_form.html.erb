<% form_for [@site, @item], :builder => AdminFormBuilder,:url => {:controller => 'user/items', :action => action, :subdomain => @site.title}, :html => { :multipart => true } do |item_form| %>
<fieldset>
  <%= item_form.error_messages %>
  <%= item_form.legend @singular, :new => item_form.object.new_record? %> 

  <fieldset class="title">
    <legend>Title</legend>
    <%= item_form.text_field :title %>
  </fieldset>
  
  <fieldset class="people">
    <legend>People</legend>
    <%= add_person_link "Add an existing person" %><br />
    <%= add_new_person_link "Add a new person", item_form %><br />
    <%= item_form.label "Authors:" %>
    <div id="people">
      <% for author in @item.authors %>
        <div class="thin_field">
          <%= item_form.label "#{author.name}" %>
          <%= hidden_field_tag "item[authors_list][]", "#{author.id}", :id => "existing_author_#{author.id}" %>
          <%= link_to_function "[remove]", "$(this).parent().remove()" %>
        </div>
      <% end %>
    </div>
    <%= hidden_field_tag "item[authors_list][]", "-1" %><!-- <hack>hidden field so that authors_list= will always be called. -1 value is -->
    <div id="new_people">
    </div>
  </fieldset>
  
  <fieldset class="places">
    <legend>Places</legend>
    <%= item_form.text_area :location, :rows => 4 %>
  </fieldset>
  
  <fieldset class="details">
    <legend>Details</legend>
      <%= item_form.check_box :published %>
      <%= item_form.text_field :reference_number, :label => "Reference No" %>
      <%= item_form.text_field :publisher %>

    <% unless @site.document_types.blank? %>
        <%= item_form.collection_select :document_type_id, @site.document_types.all, :id, :name, :include_blank => true, :label => "Document Type" %>
    <% end %>
    
      <%= item_form.text_field :year %>
      <%= item_form.field_label_with_colon "Month" %><%= select_month @item.month, :include_blank => true , :label => "Month" %><br/
      <%= item_form.field_label_with_colon "Day" %><%= select_day @item.day, :include_blank => true, :label => "Day"  %>
      <%= item_form.text_field :date_details, :label => "Date Details"  %>
      <%= item_form.text_field :dimensions %>
      <%= item_form.text_field :pagination %>
      <%= item_form.text_field :city %>
      <%= item_form.text_field :illustrations %>
      
  </fieldset> 
  <fieldset class="notes">
    <legend>Notes</legend>
    <%= item_form.text_area :notes, :rows => 10 %>
  </fieldset>
  <fieldset class="full_text">
    <legend>Full Text</legend>
    <%= item_form.text_area :full_text, :rows => 10, :label => "Full Text"  %>
  </fieldset>

  <fieldset id="categories">
    <legend>Categories</legend>
    <% unless @site.categories.blank? %>
      <%= item_form.label :categories %>
      <% for category in @item.categories %>
        <div class="thin_field">
          <%= item_form.label "#{category.name}" %>
          <%= hidden_field_tag "item[categories_list][]", "#{category.id}", :id => "existing_category_#{category.id}" %>
          <%= link_to_function "[remove]", "$(this).parent().remove()" %>
        </div>
      <% end %>
    <% end %>
    <%= hidden_field_tag "item[categories_list][]", "-1", :id => "hidden_category_-1" %>
    <% unless @site.categories.blank? %>
      <%= add_category_link "Add Category" %>
    <% end %>
      <br /><br />
  </fieldset>
  
  <fieldset id="media">
    <legend>Photos and Media</legend>
    <div id="new_photos">
      <%= render :partial => 'photo', :collection => @item.photos.reject { |p| !p.new_record? } %>
      <%= hidden_field_tag "item[photos_list][]", "-1" %><!-- <hack>hidden field so that photos_list= will always be called. -1 value is ignored.</hack> -->
    </div>
    <div class="existing_photos"><br />
      <%= render :partial => "item_photo", :collection => @item.photos.reject { |p| p.new_record?} %>
    </div>
    <%= add_photo_link "Add photo" %>
    <br /><br />
    
    <div class="existing_media_files">
      Media Files:
      <%= render :partial => "item_media_file", :collection => @item.media_files.reject { |m| m.new_record?} %>
    </div>
    <div id="new_media_files">
      <%= render :partial => 'media_file', :collection => @item.media_files.reject { |m| !m.new_record? } %>
      <%= hidden_field_tag "item[media_files_list][]", "-1" %><!-- <hack>hidden field so that media_files_list= will always be called. -1 value is ignored. This is done so removing media files will work even when none are being added.</hack> -->
    </div>
    <%= add_media_link "Add media file" %>
    <br /><br />
  </fieldset>


  <!-- ADVANCED DATA HIDDEN UNLESS NEEDED -->
  <fieldset id="advacned">
  <legend>Advanced Options</legend>
  <div class="advanced_toggle">
    <%= toggle_advanced_fields "SHOW/HIDE ADVANCED OPTIONS" %>
  </div>
  <div id="advanced_properties">
    <%= item_form.text_area :introduction %>
    <%= item_form.text_area :publisher_details %>
    <%= item_form.text_field :seller %>
    <%= item_form.text_area :seller_details %>
    <%= item_form.text_field :printer %>
    <%= item_form.text_area :printer_details %>
    <%= item_form.text_field :binder %>
    <%= item_form.text_area :binder_details %>
    <%= item_form.text_field :price %>
    <%= item_form.check_box :serialized %>
    <%= item_form.text_area :footnotes %>
    <%= item_form.text_area :endnotes %>
    <%= item_form.text_field :index %>
    <%= item_form.text_area :advertisements %>
    <%= item_form.text_field :item_binding %>
    <%= item_form.text_field :edges %>
    <%= item_form.check_box :foxing %>
    <%= item_form.text_field :provenance %>
    <%= item_form.text_field :marginalia %>
    <%= item_form.text_area :summary_of_contents %>
    <%= item_form.label :references %>
    <%= item_form.text_area :references %>
    <br />

  </div>
  </fieldset>
  
  <br />
  <!-- END OF THE ADVANCED OPTIONS -->

  <div class="submit"><%= item_form.submit "Save" %></div>
</fieldset>
<% end %>